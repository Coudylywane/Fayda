<ion-content class="!bg-green-700">
  <div class="bg-primary-green min-h-screen text-white">
    <div class="container mx-auto px-4 py-8 max-w-md">
      <!-- Logo -->
      <div class="flex justify-center mt-10 mb-8">
        <img src="assets/images/logoregistre.png" alt="faydah logo" class="h-16" />
      </div>

      <!-- Titre -->
      <h1 class="text-center text-2xl font-bold mb-6">INSCRIPTION</h1>

      <!-- Indicateur d'étapes -->
      <div class="flex justify-center mb-8">
        <div class="flex items-center space-x-2">
          <div *ngFor="let step of steps; let i = index" class="flex items-center">
            <div [class]="getStepClass(i)"
              class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-all duration-300">
              <ion-icon *ngIf="i < currentStep" name="checkmark-outline" class="w-4 h-4"></ion-icon>
              <span *ngIf="i >= currentStep">{{ i + 1 }}</span>
            </div>
            <div *ngIf="i < steps.length - 1" [class]="getConnectorClass(i)"
              class="w-8 h-0.5 transition-all duration-300"></div>
          </div>
        </div>
      </div>

      <!-- Titre de l'étape courante -->
      <h2 class="text-center text-lg font-semibold mb-6">{{ steps[currentStep].title }}</h2>

      <!-- Formulaire avec étapes -->
      <form [formGroup]="registerForm" novalidate>
        <!-- Étape 1: Informations personnelles -->
        <div *ngIf="currentStep === 0" class="space-y-4 animate-fade-in">
          <!-- Segment de genre -->
          <div class="flex justify-center mb-6">
            <div class="bg-dark-green rounded-full p-1 flex">
              <button type="button" (click)="selectGender('homme')"
                [class]="'px-6 py-2 rounded-full transition-all duration-200 text-white hover:bg-light-green ' + (selectedGender === 'homme' ? 'bg-light-green' : '')">
                M.
              </button>
              <button type="button" (click)="selectGender('femme')"
                [class]="'px-6 py-2 rounded-full transition-all duration-200 text-white hover:bg-light-green ' + (selectedGender === 'femme' ? 'bg-light-green' : '')">
                Mme.
              </button>
            </div>
          </div>

          <!-- Prénom -->
          <div class="mb-4">
            <label for="firstName" class="block text-sm font-medium text-gray-300 mb-1">Prénom</label>
            <div class="relative">
              <input id="firstName" type="text" formControlName="firstName"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                placeholder="Votre prénom"
                [ngClass]="{'!border-red-500': registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched}" />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
              </div>
            </div>
            <div *ngIf="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('firstName')?.errors?.['required']">Prénom requis</span>
            </div>
          </div>

          <!-- Nom -->
          <div class="mb-4">
            <label for="lastName" class="block text-sm font-medium text-gray-300 mb-1">Nom</label>
            <div class="relative">
              <input id="lastName" type="text" formControlName="lastName"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                placeholder="Votre nom"
                [ngClass]="{'!border-red-500': registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched}" />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
              </div>
            </div>
            <div *ngIf="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('lastName')?.errors?.['required']">Nom requis</span>
            </div>
          </div>

          <!-- Date de naissance -->
          <div class="mb-4">
            <label for="dateOfBirth" class="block text-sm font-medium text-gray-300 mb-1">Date de naissance</label>
            <div class="relative">
              <!-- <input id="dateOfBirth" type="date" formControlName="dateOfBirth"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                [ngClass]="{'!border-red-500': registerForm.get('dateOfBirth')?.invalid && registerForm.get('dateOfBirth')?.touched}" /> -->
              <app-date-selector placeholder="Sélectionnez votre date de naissance"
                (dateChange)="onDateSelected($event)" class="mb-4">
              </app-date-selector>
            </div>
            <div *ngIf="registerForm.get('dateOfBirth')?.invalid && registerForm.get('dateOfBirth')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('dateOfBirth')?.errors?.['required']">Date de naissance requise</span>
            </div>
          </div>
          <!-- Utilisation basique -->
        </div>

        <!-- Étape 2: Contact -->
        <div *ngIf="currentStep === 1" class="space-y-4 animate-fade-in">
          <!-- Email -->
          <div class="mb-4">
            <label for="email" class="block text-sm font-medium text-gray-300 mb-1">Adresse email</label>
            <div class="relative">
              <input id="email" type="email" formControlName="email"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                placeholder="email@exemple.com"
                [ngClass]="{'!border-red-500': registerForm.get('email')?.invalid && registerForm.get('email')?.touched}" />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207" />
                </svg>
              </div>
            </div>
            <div *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('email')?.errors?.['required']">Email requis</span>
              <span *ngIf="registerForm.get('email')?.errors?.['email']">Format d'email invalide</span>
            </div>
          </div>

          <!-- Téléphone -->
          <div class="mb-4">
            <label for="phoneNumber" class="block text-sm font-medium text-gray-300 mb-1">Numéro de téléphone</label>
            <div class="relative">
              <div>
                <app-phonenumber-input formControlName="phoneNumber" placeholder="Votre numéro mobile"
                  (countryChange)="onCountryChange($event)" (validationChange)="onValidationChange($event)">
                </app-phonenumber-input>
                <!-- <input id="phoneNumber" type="tel" formControlName="phoneNumber"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                placeholder="+33 6 12 34 56 78"
                [ngClass]="{'!border-red-500': registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched}" />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg> -->
              </div>
            </div>
            <div *ngIf="registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('phoneNumber')?.errors?.['required']">Numéro de téléphone requis</span>
            </div>
          </div>
        </div>

        <!-- Étape 3: Compte -->
        <div *ngIf="currentStep === 2" class="space-y-4 animate-fade-in">
          <!-- Nom d'utilisateur -->
          <div class="mb-4">
            <label for="username" class="block text-sm font-medium text-gray-300 mb-1">Nom d'utilisateur</label>
            <div class="relative">
              <input id="username" type="text" formControlName="username"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                placeholder="Votre nom d'utilisateur"
                [ngClass]="{'!border-red-500': registerForm.get('username')?.invalid && registerForm.get('username')?.touched}" />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
            </div>
            <div *ngIf="registerForm.get('username')?.invalid && registerForm.get('username')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('username')?.errors?.['required']">Nom d'utilisateur requis</span>
              <span *ngIf="registerForm.get('username')?.errors?.['minlength']">Minimum 3 caractères</span>
            </div>
          </div>

          <!-- Mot de passe -->
          <div class="mb-4">
            <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Mot de passe</label>
            <div class="relative">
              <input id="password" [type]="showPassword ? 'text' : 'password'" formControlName="password"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                placeholder="Votre mot de passe"
                [ngClass]="{'!border-red-500': registerForm.get('password')?.invalid && registerForm.get('password')?.touched}" />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                <button type="button" (click)="togglePasswordVisibility()" class="text-gray-500 hover:text-white">
                  <ion-icon [name]="showPassword ? 'eye-off-outline' : 'eye-outline'" class="w-5 h-5"></ion-icon>
                </button>
              </div>
            </div>
            <div *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('password')?.errors?.['required']">Mot de passe requis</span>
              <span *ngIf="registerForm.get('password')?.errors?.['minlength']">Minimum 6 caractères</span>
            </div>
          </div>

          <!-- Confirmer mot de passe -->
          <div class="mb-4">
            <label for="confirmPassword" class="block text-sm font-medium text-gray-300 mb-1">Confirmer mot de passe</label>
            <div class="relative">
              <input id="confirmPassword" [type]="showConfirmPassword ? 'text' : 'password'" formControlName="confirmPassword"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                placeholder="Votre mot de passe"
                [ngClass]="{'!border-red-500': registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched}" />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                <button type="button" (click)="toggleConfirmPasswordVisibility()" class="text-gray-500 hover:text-white">
                  <ion-icon [name]="showConfirmPassword ? 'eye-off-outline' : 'eye-outline'" class="w-5 h-5"></ion-icon>
                </button>
              </div>
            </div>
            <div *ngIf="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('confirmPassword')?.errors?.['required']">Mot de passe requis</span>
              <span *ngIf="registerForm.get('confirmPassword')?.errors?.['minlength']">Minimum 6 caractères</span>
              <span *ngIf="registerForm.get('confirmPassword')?.errors?.['passwordMismatch']">Les mots de passe ne correspondent pas</span>
            </div>
          </div>
        </div>

        <!-- Étape 4: Localisation -->
        <div *ngIf="currentStep === 3" class="space-y-4 animate-fade-in">

          <!-- Nationalité -->
          <div class="mb-4">
            <label for="nationality" class="block text-sm font-medium text-gray-300 mb-1">Nationalité</label>
            <div class="relative">
              <app-country-selector (selectedChange)="onNationalitySelected($event)" [options]="nationationalities">
              </app-country-selector>
            </div>
            <div *ngIf="registerForm.get('nationality')?.invalid && registerForm.get('nationality')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('nationality')?.errors?.['required']">Prénom requis</span>
            </div>
          </div>

          <!-- Pays -->
          <div class="mb-4">
            <label for="country" class="block text-sm font-medium text-gray-300 mb-1">Pays</label>
            <div class="relative">
              <app-country-selector (selectedChange)="onCountrySelected($event)" [options]="nations">
              </app-country-selector>
            </div>
            <div *ngIf="registerForm.get('country')?.invalid && registerForm.get('country')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('country')?.errors?.['required']">Prénom requis</span>
            </div>
          </div>

          <!-- Région -->
          <div class="mb-4">
            <label for="region" class="block text-sm font-medium text-gray-300 mb-1">Région</label>
            <div class="relative">
              <input id="region" type="text" formControlName="region"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                placeholder="Votre région"
                [ngClass]="{'!border-red-500': registerForm.get('region')?.invalid && registerForm.get('region')?.touched}" />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
            </div>
            <div *ngIf="registerForm.get('region')?.invalid && registerForm.get('region')?.touched"
              class="text-red-500 text-sm mt-1">
              <span *ngIf="registerForm.get('region')?.errors?.['required']">Région requise</span>
            </div>
          </div>

          <!-- Département -->
          <div class="mb-4">
            <label for="department" class="block text-sm font-medium text-gray-300 mb-1">Département</label>
            <div class="relative">
              <input id="department" type="text" formControlName="department"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                placeholder="Votre département (optionnel)" />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
              </div>
            </div>
          </div>

          <!-- Adresse -->
          <div class="mb-4">
            <label for="address" class="block text-sm font-medium text-gray-300 mb-1">Adresse complète</label>
            <div class="relative">
              <input id="address" type="text" formControlName="address"
                class="bg-transparent w-full text-white placeholder-gray-400 border-0 border-b-2 border-white pb-2 focus:outline-none focus:ring-0 focus:border-white transition-colors"
                placeholder="Votre adresse complète (optionnel)" />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation et actions -->
        <div class="flex justify-between items-center mt-8">
          <!-- Bouton Précédent -->
          <button *ngIf="currentStep > 0" type="button" (click)="previousStep()"
            class="flex items-center space-x-2 px-4 py-2 text-white hover:text-primary transition-colors">
            <ion-icon name="chevron-back-outline" class="w-5 h-5"></ion-icon>
            <span>Précédent</span>
          </button>
          <div *ngIf="currentStep === 0"></div>

          <!-- Bouton Suivant/Terminer -->
          <button type="button" (click)="nextStep()" [disabled]="!canProceed()"
            class="flex items-center space-x-2 px-6 py-3 bg-primary rounded-full text-gray-200 hover:text-gray-600 font-medium hover:bg-yellow-400 transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
            <span>{{ currentStep === steps.length - 1 ? 'Terminer' : 'Suivant' }}</span>
            <ion-icon
              [name]="isLoading ? 'refresh-outline' : (currentStep === steps.length - 1 ? 'checkmark-outline' : 'chevron-forward-outline')"
              [class]="isLoading ? 'animate-spin' : ''" class="w-5 h-5">
            </ion-icon>
          </button>
        </div>

        <!-- Message d'erreur -->
        <!-- <div *ngIf="registerError" class="bg-red-500/10 border border-red-500/80 text-red-300 p-3 rounded mt-6 text-sm">
          {{ registerError }}
        </div> -->

        <!-- Lien de connexion -->
        <div class="text-center text-sm mt-6">
          <p class="text-gray-300">Déjà inscrit ?</p>
          <button type="button" (click)="goToLogin()"
            class="text-primary underline font-medium hover:text-amber-300 transition-colors">
            Connectez-vous ici
          </button>
        </div>
      </form>
    </div>
  </div>
</ion-content>