<div class="px-6 py-4">
  <!-- Titre de la page -->
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-xl font-medium text-gray-700">
      Utilisateurs ({{ (usersCount$ | async) || 0 }})
    </h1>    
  </div>

  <!-- Barre de recherche et boutons d'action -->
  <div class="flex items-center justify-between mb-6">
    <!-- Search -->
    <div class="flex-grow max-w-md">
      <div class="relative">
        <input 
          type="text" 
          [value]="(searchTerm$ | async) || ''"
          (input)="onSearchTermChange($any($event.target).value)"
          placeholder="Rechercher par nom, email..."
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
        <svg class="h-5 w-5 text-gray-400 absolute left-3 top-2.5" fill="none" viewBox="0 0 24 24"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>
    </div>
    <div class="flex space-x-3 ml-4">
      <button (click)="openAddUserModal()"
        class="ml-auto flex items-center justify-center rounded-full h-10 w-10 bg-green-600 text-white hover:bg-green-700 focus:outline-none">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
      </button>
      <button (click)="openFilterModal()"
        class="flex items-center justify-center rounded-full h-10 w-10 bg-white shadow text-gray-700 hover:bg-gray-100 focus:outline-none">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
          <path
            d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z" />
        </svg>
      </button>
      <button (click)="refreshUsers()" [disabled]="(loading$ | async) || false"
            class="bg-black/70 hover:opacity-90 disabled:opacity-50 text-white p-3 rounded-lg transition-colors duration-200 flex items-center justify-center">
            <svg class="w-5 h-5" [class.animate-spin]="(loading$ | async) || false" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
          </button>
    </div>
  </div>

  <!-- Filtres rapides -->
  <div class="flex space-x-3 mb-6 overflow-x-auto pb-2">
    <button *ngFor="let filter of filters"
        (click)="setFilter(filter)"
        [ngClass]="{
          'bg-gray-800 text-white': (category$ | async) === filter, 
          'bg-gray-100 text-gray-800': (category$ | async) !== filter
        }"
        class="px-4 py-2 rounded-full text-sm font-medium transition-colors whitespace-nowrap">
        {{ filter }}
        <span *ngIf="filter === (category$ | async) && ((filteredUsersCount$ | async) || 0) > 0"
          class="ml-2 bg-white text-gray-800 px-2 py-1 rounded-full text-xs">
          {{ filteredUsersCount$ | async }}
        </span>
      </button>
  </div>

  <!-- Indicateur de chargement -->
  <div *ngIf="(loading$ | async)" class="flex justify-center items-center py-8">
    <ion-spinner name="circular" color="primary"></ion-spinner>
    <span class="ml-3 text-gray-600">Chargement des utilisateurs...</span>
  </div>

  <!-- Message si aucun utilisateur -->
  <ng-container *ngIf="!(loading$ | async)">
    <div *ngIf="((usersCount$ | async) || 0) === 0" class="text-center py-8">
      <ion-icon name="people-outline" class="text-6xl text-gray-300 mb-4"></ion-icon>
      <h3 class="text-lg font-medium text-gray-600 mb-2">Aucun utilisateur trouvé</h3>
      <p class="text-gray-500">Commencez par ajouter votre premier utilisateur</p>
      <button (click)="openAddUserModal()"
        class="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
        Ajouter un utilisateur
      </button>
    </div>

    <!-- Message si aucun résultat après filtrage -->
    <div *ngIf="((usersCount$ | async) || 0) > 0 && ((filteredUsersCount$ | async) || 0) === 0" class="text-center py-8">
      <ion-icon name="search-outline" class="text-6xl text-gray-300 mb-4"></ion-icon>
      <h3 class="text-lg font-medium text-gray-600 mb-2">Aucun résultat trouvé</h3>
      <p class="text-gray-500">Essayez de modifier vos critères de recherche ou de filtrage</p>
      <button (click)="resetFilters()"
        class="mt-4 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
        Réinitialiser les filtres
      </button>
    </div>
  </ng-container>

  <!-- Liste des utilisateurs -->
  <div *ngIf="!(loading$ | async) && ((filteredUsersCount$ | async) || 0) > 0" 
       class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    <div *ngFor="let user of (filteredUsers$ | async)"
      class="relative bg-white rounded-lg p-4 border border-gray-200 flex items-center transition-shadow hover:shadow-md cursor-pointer">
      <!-- Avatar -->
      <div class="relative overflow-hidden w-14 h-14 rounded-full mr-4 bg-gray-200">
        <img title="{{user.id}}" [src]="user.image || 'assets/images/1.png'" [alt]="user.name"
          class="w-full h-full object-cover" (error)="onImageError($event)" />
        <!-- Indicateur de statut -->
        <div class="absolute bottom-0 right-0 w-4 h-4 rounded-full border-2 border-white"
          [ngClass]="{'bg-green-500': user.active, 'bg-red-500': !user.active}"></div>
      </div>

      <!-- Informations utilisateur -->
      <div class="flex-grow">
        <h3 class="text-lg font-medium text-gray-800">{{ user.name || (user.firstName + ' ' + user.lastName) }}</h3>
        <p class="text-sm text-gray-600">{{ user.email }}</p>
        <div class="flex items-center space-x-2 mt-1">
          <span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full">
            {{ user.category || 'Utilisateur' }}
          </span>
          <span class="text-xs text-gray-500">{{ user.gender }}</span>
        </div>
      </div>

      <!-- Menu d'options -->
      <button (click)="openUserOptions(user)" class="text-gray-500 hover:text-gray-700 p-2" title="Options">
        <ion-icon name="ellipsis-vertical-outline" class="text-xl"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Résumé en bas de page -->
  <div *ngIf="!(loading$ | async) && ((usersCount$ | async) || 0) > 0" class="mt-6 text-center text-sm text-gray-500">
    Affichage de {{ filteredUsersCount$ | async }} sur {{ usersCount$ | async }} utilisateur(s)
  </div>
</div>