<!-- add-dahira-modal.component.html -->
<div class="bg-white rounded-lg shadow-lg overflow-hidden max-w-2xl w-full">
  <!-- Header avec stepper -->
  <div class="p-6 border-b border-gray-200">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Ajouter un nouveau Dahira</h3>

    <!-- Stepper Indicator -->
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center space-x-4">
        <!-- Étape 1 -->
        <div class="flex items-center">
          <div class="flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium"
            [class]="currentStep >= 1 ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-600'">
            1
          </div>
          <span class="ml-2 text-sm font-medium text-gray-900">Informations</span>
        </div>

        <!-- Ligne de connexion -->
        <div class="h-px flex-1 mx-4" [class]="currentStep > 1 ? 'bg-green-600' : 'bg-gray-200'"></div>

        <!-- Étape 2 -->
        <div class="flex items-center">
          <div class="flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium"
            [class]="currentStep >= 2 ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-600'">
            2
          </div>
          <span class="ml-2 text-sm font-medium text-gray-900">Contact</span>
        </div>

        <!-- Ligne de connexion -->
        <div class="h-px flex-1 mx-4" [class]="currentStep > 2 ? 'bg-green-600' : 'bg-gray-200'"></div>

        <!-- Étape 3 -->
        <div class="flex items-center">
          <div class="flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium"
            [class]="currentStep >= 3 ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-600'">
            3
          </div>
          <span class="ml-2 text-sm font-medium text-gray-900">Localisation</span>
        </div>
      </div>
    </div>

    <div class="mt-6 text-center">
      <h4 class="text-lg font-semibold text-gray-800 bg-white px-4 py-2 inline-block ">
        {{ getStepTitle() }}
      </h4>
    </div>
  </div>

  <!-- Contenu du formulaire -->
  <div class="p-6">
    <form [formGroup]="dahiraForm" (ngSubmit)="onSubmit()">

      <!-- Étape 1: Informations générales -->
      <div *ngIf="currentStep === 1" class="space-y-6 animate-fade-in">
        <div class="space-y-2">
          <label for="dahiraName" class="flex items-center text-sm font-semibold text-gray-700">
            <ion-icon name="home-outline" class="text-gray-400 mr-2"></ion-icon>
            Nom du Dahira *
          </label>
          <input type="text" id="dahiraName" formControlName="dahiraName"
            class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-gray-50 focus:bg-white"
            placeholder="Entrez le nom du Dahira">
          <div
            *ngIf="dahiraForm.get('dahiraName')?.invalid && (dahiraForm.get('dahiraName')?.dirty || dahiraForm.get('dahiraName')?.touched)"
            class="text-red-500 text-sm flex items-center mt-1">
            <ion-icon name="alert-circle-outline" class="mr-1"></ion-icon>
            <div *ngIf="dahiraForm.get('dahiraName')?.errors?.['required']">
              Le nom du Dahira est requis.
            </div>
            <div *ngIf="dahiraForm.get('dahiraName')?.errors?.['minlength']">
              Le nom doit contenir au moins 3 caractères.
            </div>
          </div>
        </div>
      </div>

      <!-- Étape 2: Contact -->
      <div *ngIf="currentStep === 2" class="space-y-6 animate-fade-in">
        <div class="space-y-2">
          <label for="email" class="flex items-center text-sm font-semibold text-gray-700">
            <ion-icon name="mail-outline" class="text-gray-400 mr-2"></ion-icon>
            Email *
          </label>
          <input type="email" id="email" formControlName="email"
            class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-gray-50 focus:bg-white"
            placeholder="exemple@email.com">
          <div
            *ngIf="dahiraForm.get('email')?.invalid && (dahiraForm.get('email')?.dirty || dahiraForm.get('email')?.touched)"
            class="text-red-500 text-sm flex items-center mt-1">
            <ion-icon name="alert-circle-outline" class="mr-1"></ion-icon>
            <div *ngIf="dahiraForm.get('email')?.errors?.['required']">
              L'email est requis.
            </div>
            <div *ngIf="dahiraForm.get('email')?.errors?.['email']">
              L'email n'est pas valide.
            </div>
          </div>
        </div>

        <div class="space-y-2">
          <label for="phoneNumber" class="flex items-center text-sm font-semibold text-gray-700">
            <ion-icon name="call-outline" class="text-gray-400 mr-2 mb-2"></ion-icon>
            Numéro de téléphone *
          </label>
          <div class="">
            <app-phone-input formControlName="phoneNumber" placeholder="Votre numéro mobile">
            </app-phone-input>
          </div>
          <div
            *ngIf="dahiraForm.get('phoneNumber')?.invalid && (dahiraForm.get('phoneNumber')?.dirty || dahiraForm.get('phoneNumber')?.touched)"
            class="text-red-500 text-sm flex items-center mt-1">
            <ion-icon name="alert-circle-outline" class="mr-1"></ion-icon>
            <div *ngIf="dahiraForm.get('phoneNumber')?.errors?.['required']">
              Le numéro de téléphone est requis.
            </div>
            <div *ngIf="dahiraForm.get('phoneNumber')?.errors?.['pattern']">
              Le format du numéro n'est pas valide (ex: +221771234567).
            </div>
          </div>
        </div>
      </div>

      <!-- Étape 3: Localisation -->
      <div *ngIf="currentStep === 3" class="space-y-6 animate-fade-in">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-2">
            <label for="country" class="flex items-center text-sm font-semibold text-gray-700">
              <ion-icon name="flag-outline" class="text-gray-400 mr-2"></ion-icon>
              Pays *
            </label>
            <div class="relative">
              <app-country-selector2 (selectedChange)="onCountrySelected($event)" [options]="nations">
              </app-country-selector2>
            </div>
            <div
              *ngIf="dahiraForm.get('country')?.invalid && (dahiraForm.get('country')?.dirty || dahiraForm.get('country')?.touched)"
              class="text-red-500 text-sm flex items-center mt-1">
              <ion-icon name="alert-circle-outline" class="mr-1"></ion-icon>
              <div *ngIf="dahiraForm.get('country')?.errors?.['required']">
                Le pays est requis.
              </div>
            </div>
          </div>

          <div class="space-y-2">
            <label for="region" class="flex items-center text-sm font-semibold text-gray-700">
              <ion-icon name="location-outline" class="text-gray-400 mr-2"></ion-icon>
              Région *
            </label>
            <input type="text" id="region" formControlName="region"
              class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-gray-50 focus:bg-white"
              placeholder="Dakar, Thiès, Saint-Louis...">
            <div
              *ngIf="dahiraForm.get('region')?.invalid && (dahiraForm.get('region')?.dirty || dahiraForm.get('region')?.touched)"
              class="text-red-500 text-sm flex items-center mt-1">
              <ion-icon name="alert-circle-outline" class="mr-1"></ion-icon>
              <div *ngIf="dahiraForm.get('region')?.errors?.['required']">
                La région est requise.
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-2">
          <label for="department" class="flex items-center text-sm font-semibold text-gray-700">
            <ion-icon name="business-outline" class="text-gray-400 mr-2"></ion-icon>
            Département *
          </label>
          <input type="text" id="department" formControlName="department"
            class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-gray-50 focus:bg-white"
            placeholder="Pikine, Guédiawaye, Rufisque...">
          <div
            *ngIf="dahiraForm.get('department')?.invalid && (dahiraForm.get('department')?.dirty || dahiraForm.get('department')?.touched)"
            class="text-red-500 text-sm flex items-center mt-1">
            <ion-icon name="alert-circle-outline" class="mr-1"></ion-icon>
            <div *ngIf="dahiraForm.get('department')?.errors?.['required']">
              Le département est requis.
            </div>
          </div>
        </div>

        <div class="space-y-2">
          <label for="address" class="flex items-center text-sm font-semibold text-gray-700">
            <ion-icon name="map-outline" class="text-gray-400 mr-2"></ion-icon>
            Adresse complète *
          </label>
          <textarea id="address" formControlName="address" rows="4"
            class="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-gray-50 focus:bg-white resize-none"
            placeholder="Adresse détaillée du Dahira"></textarea>
          <div
            *ngIf="dahiraForm.get('address')?.invalid && (dahiraForm.get('address')?.dirty || dahiraForm.get('address')?.touched)"
            class="text-red-500 text-sm flex items-center mt-1">
            <ion-icon name="alert-circle-outline" class="mr-1"></ion-icon>
            <div *ngIf="dahiraForm.get('address')?.errors?.['required']">
              L'adresse est requise.
            </div>
          </div>
        </div>
      </div>

    </form>
  </div>

  <!-- Navigation buttons -->
  <div class="flex justify-between items-center p-4 bg-gray-50 border-t border-gray-200">
    <div class="flex space-x-2">
      <button type="button" (click)="onCancel()"
        class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors">
        Annuler
      </button>
    </div>

    <div class="flex space-x-2">
      <button type="button" (click)="previousStep()" *ngIf="currentStep > 1"
        class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors">
        Précédent
      </button>

      <button type="button" (click)="nextStep()" *ngIf="currentStep < totalSteps"
        class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-colors">
        Suivant
      </button>

      <button type="button" (click)="onSubmit()" *ngIf="currentStep === totalSteps"
        [disabled]="dahiraForm.invalid || isloading"
        class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-transform hover:scale-105">
        {{isloading? "Envoie..." : "Enregistrer"}}
        <svg *ngIf="isloading" class="animate-spin h-5 w-5 text-[#333333]" xmlns="http://www.w3.org/2000/svg"
          fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
          </path>
        </svg>
      </button>
    </div>
  </div>
</div>